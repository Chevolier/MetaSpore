nohup: ignoring input
Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
24/07/07 11:46:29 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
24/07/07 11:46:29 WARN SparkConf: Note that spark.local.dir will be overridden by the value set by the cluster manager (via SPARK_LOCAL_DIRS in mesos/standalone/kubernetes and LOCAL_DIRS in YARN).
24/07/07 11:46:31 WARN MetricsConfig: Cannot locate configuration: tried hadoop-metrics2-s3a-file-system.properties,hadoop-metrics2.properties
[Stage 0:>                                                                                                                          (0 + 1) / 1]                                                                                                                                                [Stage 2:>                                                                                                                       (0 + 32) / 200][Stage 2:===================>                                                                                                   (32 + 32) / 200][Stage 2:===================>                                                                                                   (32 + 33) / 200][Stage 2:========================>                                                                                              (42 + 33) / 200][Stage 2:=======================================>                                                                               (66 + 32) / 200][Stage 2:=================================================>                                                                     (84 + 32) / 200][Stage 2:==============================================================>                                                       (106 + 32) / 200][Stage 2:==================================================================================>                                   (139 + 32) / 200][Stage 2:=========================================================================================================>            (179 + 21) / 200][Stage 4:==============================================================================================>                         (78 + 21) / 99]                                                                                                                                                [Stage 9:>                                                                                                                       (1 + 32) / 201][Stage 9:===================>                                                                                                   (33 + 32) / 201][Stage 9:===========================>                                                                                           (47 + 32) / 201][Stage 9:==============================================>                                                                        (78 + 32) / 201][Stage 9:===============================================================>                                                      (108 + 32) / 201][Stage 9:=================================================================================>                                    (139 + 32) / 201][Stage 9:===================================================================================================>                  (169 + 32) / 201][Stage 9:====================================================================================================================>  (196 + 5) / 201]                                                                                                                                                [Stage 19:===========================================>                                                                          (73 + 32) / 200][Stage 19:===============================================================>                                                     (108 + 32) / 200][Stage 19:====================================================================================>                                (144 + 32) / 200][Stage 19:==========================================================================================================>          (182 + 18) / 200]                                                                                                                                                [Stage 26:=======================================>                                                                              (68 + 32) / 201][Stage 26:==========================================================>                                                          (100 + 32) / 201][Stage 26:=================================================================>                                                   (113 + 32) / 201][Stage 26:===================================================================================>                                 (144 + 32) / 201][Stage 26:======================================================================================================>              (176 + 25) / 201][Stage 30:===========================================================================>                                          (64 + 32) / 100]                                                                                                                                                [Stage 31:============================>                                                                                         (48 + 32) / 200][Stage 31:====================================================>                                                                 (89 + 32) / 200][Stage 31:==========================================================================>                                          (127 + 32) / 200][Stage 31:===================================================================================================>                 (170 + 30) / 200]                                                                                                                                                [Stage 43:=========================>                                                                                            (44 + 32) / 200][Stage 43:===============================================>                                                                      (80 + 32) / 200][Stage 43:==================================================================>                                                  (114 + 32) / 200][Stage 43:======================================================================================>                              (148 + 32) / 200][Stage 43:===========================================================================================================>         (184 + 16) / 200]                                                                                                                                                Debug -- Movielens 1M Rank Dataset
Debug -- conf: rank.yaml.dev verbose: True
Debug -- load config:  {'app_name': 'MovieLens 1M Rank Dataset', 'local': False, 'executor_memory': '10G', 'executor_instances': '4', 'executor_cores': '4', 'default_parallelism': '400', 'fg_dataset_path': 's3a://sagemaker-us-west-2-452145973879/datasets/movielens/1m/fg/fg_dataset.parquet', 'rank_train_dataset_out_path': 's3a://sagemaker-us-west-2-452145973879/datasets/movielens/1m/rank/train.parquet', 'rank_test_dataset_out_path': 's3a://sagemaker-us-west-2-452145973879/datasets/movielens/1m/rank/test.parquet'}
Debug -- spark init
Debug -- version: 3.5.1
Debug -- applicaitonId: local-1720352790267
Debug -- uiWebUrl: http://ip-172-16-14-249.us-west-2.compute.internal:4040
Debug -- fg dataset sample:
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+--------------------+----+--------------------+------+----------+--------------------+---------+
|label|user_id|gender|age|occupation|  zip|movie_id|    recent_movie_ids| recent_movie_genres|  recent_movie_years|year|               genre|rating|last_movie|          last_genre|timestamp|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+--------------------+----+--------------------+------+----------+--------------------+---------+
|    1|      2|     M| 56|        16|70072|    2194|30711244369912...|DramaComedy|Dram...|19871979198419...|1987|  ActionCrimeDrama|   4.0|      2268|         CrimeDrama|978299297|
|    1|      4|     M| 45|         7|02460|    2366|34684803527119...|DramaAction|Adve...|19611993198719...|1933|ActionAdventure...|   4.0|      1201|      ActionWestern|978294230|
|    1|      5|     M| 25|        20|55455|    2858|9192717908356...|Adventure|Childre...|19391989195919...|1999|        ComedyDrama|   4.0|      1127|ActionAdventure...|978241390|
|    1|      5|     M| 25|        20|55455|    2427|16831722194192...|Drama|Romance|Thr...|19971997199519...|1998|    ActionDramaWar|   5.0|      1733|       DramaRomance|978246450|
|    1|      5|     M| 25|        20|55455|    1527|19419213266272...|DramaSci-Fi|Thri...|19951998199219...|1997|       ActionSci-Fi|   3.0|      1909|MysterySci-FiTh...|978246479|
|    1|     10|     F| 35|         1|95370|    1967|59211041257108...|Action|Adventure|...|19891951198519...|1986|AdventureChildre...|   5.0|      1287|ActionAdventure...|978227442|
|    1|     10|     F| 35|         1|95370|    1918|24971586368821...|RomanceAction|Dr...|19991997198119...|1998|ActionComedyCri...|   3.0|      1513|              Comedy|978230230|
|    1|     11|     F| 25|         1|04093|    1732|23593572109317...|ComedyComedy|Rom...|19981994197919...|1998|ComedyCrimeMyst...|   4.0|       104|              Comedy|978903927|
|    1|     15|     M| 25|         7|22903|    3566|28413798276311...|ThrillerThriller...|19992000199919...|2000|        ComedyDrama|   2.0|      2424|      ComedyRomance|978197314|
|    1|     15|     M| 25|         7|22903|    1610|19231271473105...|ComedyDramaCrim...|19981991199519...|1990|     ActionThriller|   4.0|      1885|        ComedyDrama|978198169|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+--------------------+----+--------------------+------+----------+--------------------+---------+
only showing top 10 rows

Debug -- prepare_rank_train cost time: 0.12800216674804688
Debug -- rank train sample size: 734409
Debug -- rank train data types: [('label', 'string'), ('user_id', 'string'), ('gender', 'string'), ('age', 'string'), ('occupation', 'string'), ('zip', 'string'), ('movie_id', 'string'), ('recent_movie_ids', 'string'), ('recent_movie_genres', 'string'), ('recent_movie_years', 'string'), ('year', 'string'), ('genre', 'string'), ('last_movie', 'string'), ('last_genre', 'string')]
Debug -- rank train sample:
+-----+-------+------+---+----------+---------+--------+--------------------+--------------------+--------------------+----+--------------------+----------+--------------------+
|label|user_id|gender|age|occupation|      zip|movie_id|    recent_movie_ids| recent_movie_genres|  recent_movie_years|year|               genre|last_movie|          last_genre|
+-----+-------+------+---+----------+---------+--------+--------------------+--------------------+--------------------+----+--------------------+----------+--------------------+
|    1|   3473|     F| 35|        16|    02472|    2622|28022011113524...|Action|Romance|Th...|19881989198019...|1999|      ComedyFantasy|      3534|              Comedy|
|    1|    803|     M| 18|         4|    67217|    2115|29161215480204...|Action|Adventure|...|19901993199319...|1984|    ActionAdventure|      2105|ActionAdventure...|
|    1|   2172|     M| 18|        20|    60641|     101|23293210228519...|DramaComedyDram...|19981982196819...|1996|              Comedy|      2321|              Comedy|
|    1|   2347|     M| 35|         1|    48116|     858|       91219613095|Drama|Romance|War...|      194219881940|1972|  ActionCrimeDrama|      3095|               Drama|
|    1|   1680|     M| 25|        20|    95380|    3152|33602917108237...|DramaCrime|Thril...|19861981197219...|1971|               Drama|      3135|               Drama|
|    1|   5100|     M| 50|         6|193122042|    3221|30712551292935...|DramaDrama|Thril...|19871988198119...|1982|               Drama|      2639|               Drama|
|    1|   3299|     F| 25|         4|    19119|    2692|29082858191229...|DramaComedy|Dram...|19991999199819...|1998|ActionCrimeRomance|       527|           DramaWar|
|    1|   5619|     F| 18|         4|    22310|     440|36843563668244...|Drama|RomanceCom...|19891994196819...|1993|      ComedyRomance|      1094|   DramaRomanceWar|
|    1|    575|     M| 25|        12|    92130|    3578|44215441690191...|Action|Sci-FiAct...|19931997199719...|2000|        ActionDrama|      3510|      DramaThriller|
|    1|   3469|     M| 45|        17|    02176|    1643|10122622728167...|Children's|Drama...|19571995196019...|1997|       DramaRomance|      3386|       DramaMystery|
+-----+-------+------+---+----------+---------+--------+--------------------+--------------------+--------------------+----+--------------------+----------+--------------------+
only showing top 10 rows

Debug -- prepare_rank_train total cost time: 11.696779489517212
Debug -- prepare_rank_train cost time: 0.04926896095275879
Debug -- rank test sample size: 4603
Debug -- rank test data types: [('label', 'string'), ('user_id', 'string'), ('gender', 'string'), ('age', 'string'), ('occupation', 'string'), ('zip', 'string'), ('movie_id', 'string'), ('recent_movie_ids', 'string'), ('recent_movie_genres', 'string'), ('recent_movie_years', 'string'), ('year', 'string'), ('genre', 'string'), ('last_movie', 'string'), ('last_genre', 'string')]
Debug -- rank test sample:
[Stage 51:========================================>                                                                             (69 + 32) / 200][Stage 51:=============================================================>                                                       (105 + 32) / 200][Stage 51:=================================================================================>                                   (140 + 32) / 200][Stage 51:========================================================================================================>            (179 + 21) / 200]                                                                                                                                                [Stage 58:=========================================>                                                                            (70 + 32) / 201][Stage 58:===========================================================>                                                         (102 + 32) / 201][Stage 58:==============================================================================>                                      (134 + 32) / 201][Stage 58:================================================================================================>                    (166 + 32) / 201][Stage 58:===================================================================================================================>  (196 + 5) / 201]                                                                                                                                                [Stage 66:=================================================================================>                                    (69 + 31) / 100][Stage 71:>                                                                                                                      (0 + 32) / 100][Stage 71:=>                                                                                                                     (1 + 32) / 100][Stage 71:=====================================>                                                                                (32 + 32) / 100][Stage 71:==========================================>                                                                           (36 + 32) / 100][Stage 71:=========================================================================>                                            (62 + 32) / 100][Stage 71:===========================================================================>                                          (64 + 32) / 100][Stage 71:=============================================================================>                                        (66 + 32) / 100][Stage 71:=============================================================================================>                        (79 + 21) / 100][Stage 71:==================================================================================================================>    (96 + 4) / 100][Stage 71:====================================================================================================================>  (98 + 2) / 100]                                                                                                                                                [Stage 72:====================================================>                                                                 (89 + 32) / 200][Stage 72:=========================================================================>                                           (125 + 32) / 200][Stage 72:==============================================================================================>                      (161 + 32) / 200][Stage 72:====================================================================================================================> (197 + 3) / 200]                                                                                                                                                [Stage 86:>                                                                                                                         (0 + 1) / 1]                                                                                                                                                /home/ec2-user/anaconda3/envs/metaspore/lib/python3.8/site-packages/pyspark/sql/dataframe.py:329: FutureWarning: Deprecated in 2.0, use createOrReplaceTempView instead.
  warnings.warn("Deprecated in 2.0, use createOrReplaceTempView instead.", FutureWarning)
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+--------------------+----+--------------------+----------+--------------------+
|label|user_id|gender|age|occupation|  zip|movie_id|    recent_movie_ids| recent_movie_genres|  recent_movie_years|year|               genre|last_movie|          last_genre|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+--------------------+----+--------------------+----------+--------------------+
|    1|   1315|     M| 35|         7|75214|    1269|91929612133783...|Adventure|Childre...|19391994199019...|1944|ComedyMysteryTh...|      3317|        ComedyDrama|
|    1|    425|     M| 25|        12|55303|    1394|14524704712112...|ActionAdventure|...|19951986199419...|1987|              Comedy|      1517|              Comedy|
|    1|   4507|     M| 18|         4|61820|    2492|15134481298780...|Drama|Romance|War...|19951987198219...|1998|              Comedy|      2012|ComedySci-FiWes...|
|    0|   2302|     M| 50|        12|48104|    2212|12339241299296...|Action|Drama|War...|19811968198419...|1934|            Thriller|      3363|        ComedyDrama|
|    1|   2295|     M| 45|        11|72316|    1200|13673534284624...|Children's|Comedy...|19962000198619...|1986|ActionSci-FiThr...|      1214|ActionHorrorSci...|
|    0|   4172|     M| 35|         7|19901|    2602|17291721122185...|Crime|DramaDrama...|19971997197419...|1977|    AdventureSci-Fi|      3174|        ComedyDrama|
|    1|   5991|     F| 35|        20|94025|    2273|34381204300017...|Action|Children's...|19901962199719...|1998|     ActionThriller|      1339|      HorrorRomance|
|    1|    892|     M| 35|         0|76031|     924|35620801079130...|Comedy|Romance|Wa...|19941955198819...|1968|DramaMysterySci...|      1210|ActionAdventure...|
|    1|   4966|     M| 50|        14|55407|    3755|29512120003635...|Action|WesternAc...|19641995198719...|2000|ActionAdventure...|      1376|ActionAdventure...|
|    0|   1099|     M| 25|        17|77059|     502|11001917208485...|Action|RomanceAc...|19901998199519...|1994|   ActionChildren's|      3705|ActionAdventure...|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+--------------------+----+--------------------+----------+--------------------+
only showing top 10 rows

Debug -- prepare_rank_train total cost time: 3.874704122543335
Debug -- write_dataset_to_s3 train cost time: 56.804274559020996
Debug -- write_dataset_to_s3 test cost time: 3.5692360401153564
Debug -- spark stop
