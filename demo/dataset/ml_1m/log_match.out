nohup: ignoring input
updating: common/ (stored 0%)
updating: common/neg_sampler.py (deflated 65%)
updating: common/__init__.py (deflated 38%)
updating: common/criteo_sparse_features_extractor.py (deflated 54%)
updating: common/ml_sparse_features_extractor.py (deflated 76%)
updating: common/__pycache__/ (stored 0%)
updating: common/__pycache__/ml_sparse_features_extractor.cpython-38.pyc (deflated 63%)
updating: common/__pycache__/__init__.cpython-38.pyc (deflated 19%)
updating: common/__pycache__/neg_sampler.cpython-38.pyc (deflated 51%)
24/07/07 11:31:28 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
24/07/07 11:31:28 WARN SparkConf: Note that spark.local.dir will be overridden by the value set by the cluster manager (via SPARK_LOCAL_DIRS in mesos/standalone/kubernetes and LOCAL_DIRS in YARN).
24/07/07 11:31:30 WARN MetricsConfig: Cannot locate configuration: tried hadoop-metrics2-s3a-file-system.properties,hadoop-metrics2.properties
[Stage 2:>                                                                                                          (0 + 32) / 200][Stage 2:================>                                                                                         (32 + 32) / 200][Stage 2:=================>                                                                                        (33 + 32) / 200][Stage 2:====================>                                                                                     (38 + 33) / 200][Stage 2:===================================>                                                                      (67 + 32) / 200][Stage 2:===========================================>                                                              (83 + 32) / 200][Stage 2:============================================================>                                            (116 + 32) / 200][Stage 2:===========================================================================>                             (144 + 32) / 200][Stage 2:========================================================================================>                (168 + 32) / 200][Stage 2:========================================================================================================> (198 + 2) / 200][Stage 4:=======================================================================================================>  (129 + 3) / 132]                                                                                                                                   [Stage 9:=>                                                                                                         (2 + 32) / 203][Stage 9:==============>                                                                                           (28 + 33) / 203][Stage 9:==================>                                                                                       (35 + 32) / 203][Stage 9:==================================>                                                                       (67 + 32) / 203][Stage 9:=======================================>                                                                  (75 + 32) / 203][Stage 9:======================================================>                                                  (105 + 33) / 203][Stage 9:=======================================================================>                                 (139 + 32) / 203][Stage 9:=======================================================================================>                 (170 + 32) / 203][Stage 9:=========================================================================================================>(202 + 1) / 203][Stage 13:=========================================================================>                              (141 + 33) / 200]                                                                                                                                   [Stage 19:=================================>                                                                       (64 + 32) / 200][Stage 19:=====================================>                                                                   (71 + 32) / 200][Stage 19:======================================================>                                                 (104 + 32) / 200][Stage 19:========================================================================>                               (139 + 32) / 200][Stage 19:==========================================================================================>             (174 + 26) / 200]                                                                                                                                   [Stage 26:==================================>                                                                      (67 + 32) / 203][Stage 26:==========================================>                                                              (83 + 32) / 203][Stage 26:=========================================================>                                              (112 + 32) / 203][Stage 26:==========================================================================>                             (146 + 32) / 203][Stage 26:============================================================================================>           (180 + 23) / 203][Stage 30:==================================================================================>                     (158 + 33) / 200]                                                                                                                                   [Stage 31:==================================>                                                                      (65 + 32) / 200][Stage 31:=====================================================>                                                  (103 + 32) / 200][Stage 31:=======================================================================>                                (138 + 32) / 200][Stage 31:=========================================================================================>              (173 + 27) / 200]                                                                                                                                   [Stage 43:====================================>                                                                    (70 + 32) / 200][Stage 43:=======================================================>                                                (107 + 32) / 200][Stage 43:==========================================================================>                             (143 + 32) / 200][Stage 43:=============================================================================================>          (180 + 20) / 200]                                                                                                                                   Debug -- MovieLens 1M Match Dataset
Debug -- conf: match_dataset.yaml.dev verbose: True
Debug -- load config:  {'app_name': 'MovieLens 1M Match Dataset', 'local': False, 'executor_memory': '10G', 'executor_instances': '4', 'executor_cores': '4', 'default_parallelism': '400', 'fg_dataset_path': 's3a://sagemaker-us-west-2-452145973879/datasets/movielens/1m/fg/fg_dataset.parquet', 'match_train_dataset_out_path': 's3a://sagemaker-us-west-2-452145973879/datasets/movielens/1m/cf/train.parquet', 'match_test_dataset_out_path': 's3a://sagemaker-us-west-2-452145973879/datasets/movielens/1m/cf/test.parquet'}
Debug -- spark init
Debug -- version: 3.5.1
Debug -- applicaitonId: local-1720351889273
Debug -- uiWebUrl: http://ip-172-16-14-249.us-west-2.compute.internal:4040
Debug -- read dataset sample:
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+--------------------+----+--------------------+------+----------+--------------------+---------+
|label|user_id|gender|age|occupation|  zip|movie_id|    recent_movie_ids| recent_movie_genres|  recent_movie_years|year|               genre|rating|last_movie|          last_genre|timestamp|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+--------------------+----+--------------------+------+----------+--------------------+---------+
|    1|      2|     M| 56|        16|70072|    2194|30711244369912...|DramaComedy|Dram...|19871979198419...|1987|  ActionCrimeDrama|   4.0|      2268|         CrimeDrama|978299297|
|    1|      4|     M| 45|         7|02460|    2366|34684803527119...|DramaAction|Adve...|19611993198719...|1933|ActionAdventure...|   4.0|      1201|      ActionWestern|978294230|
|    1|      5|     M| 25|        20|55455|    2858|9192717908356...|Adventure|Childre...|19391989195919...|1999|        ComedyDrama|   4.0|      1127|ActionAdventure...|978241390|
|    1|      5|     M| 25|        20|55455|    2427|16831722194192...|Drama|Romance|Thr...|19971997199519...|1998|    ActionDramaWar|   5.0|      1733|       DramaRomance|978246450|
|    1|      5|     M| 25|        20|55455|    1527|19419213266272...|DramaSci-Fi|Thri...|19951998199219...|1997|       ActionSci-Fi|   3.0|      1909|MysterySci-FiTh...|978246479|
|    1|     10|     F| 35|         1|95370|    1967|59211041257108...|Action|Adventure|...|19891951198519...|1986|AdventureChildre...|   5.0|      1287|ActionAdventure...|978227442|
|    1|     10|     F| 35|         1|95370|    1918|24971586368821...|RomanceAction|Dr...|19991997198119...|1998|ActionComedyCri...|   3.0|      1513|              Comedy|978230230|
|    1|     11|     F| 25|         1|04093|    1732|23593572109317...|ComedyComedy|Rom...|19981994197919...|1998|ComedyCrimeMyst...|   4.0|       104|              Comedy|978903927|
|    1|     15|     M| 25|         7|22903|    3566|28413798276311...|ThrillerThriller...|19992000199919...|2000|        ComedyDrama|   2.0|      2424|      ComedyRomance|978197314|
|    1|     15|     M| 25|         7|22903|    1610|19231271473105...|ComedyDramaCrim...|19981991199519...|1990|     ActionThriller|   4.0|      1885|        ComedyDrama|978198169|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+--------------------+----+--------------------+------+----------+--------------------+---------+
only showing top 10 rows

Debug -- match train dataset size: 982089
Debug -- match train types: [('label', 'string'), ('user_id', 'string'), ('gender', 'string'), ('age', 'string'), ('occupation', 'string'), ('zip', 'string'), ('movie_id', 'string'), ('recent_movie_ids', 'string'), ('recent_movie_genres', 'string'), ('recent_movie_years', 'string'), ('year', 'string'), ('genre', 'string'), ('rating', 'string'), ('last_movie', 'string'), ('last_genre', 'string'), ('timestamp', 'string')]
Debug -- match train dataset sample:
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+--------------------+----+--------------------+------+----------+--------------------+---------+
|label|user_id|gender|age|occupation|  zip|movie_id|    recent_movie_ids| recent_movie_genres|  recent_movie_years|year|               genre|rating|last_movie|          last_genre|timestamp|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+--------------------+----+--------------------+------+----------+--------------------+---------+
|    1|   4007|     M| 35|        12|88005|     674|26002530139136...|Action|Sci-Fi|Thr...|19991970199619...|1968|    AdventureSci-Fi|   2.0|      1320|ActionHorrorSci...|965547830|
|    1|   3476|     M| 50|         0|44126|    1198|2804196990433...|Comedy|DramaAnim...|19831995195119...|1981|    ActionAdventure|   5.0|      1225|               Drama|967128777|
|    1|   2029|     F| 25|        12|10011|    2321|39459102858278...|Adventure|Animati...|20001959199919...|1998|              Comedy|   5.0|      1136|              Comedy|974671161|
|    1|    963|     M| 25|         0|48197|    1287|51727521464326...|Action|Drama|Myst...|19931987199719...|1959|ActionAdventure...|   5.0|      1291|    ActionAdventure|975120206|
|    1|   3018|     M| 35|         0|45242|    1090|14096051100351...|Comedy|RomanceDr...|19961996199019...|1986|           DramaWar|   4.0|      3214|               Drama|970607516|
|    1|   4355|     M| 50|        14|08028|    2021|43513721573167...|Comedy|Sci-FiAct...|19931991199719...|1984|      FantasySci-Fi|   5.0|       780|   ActionSci-FiWar|965191496|
|    1|    598|     M| 35|         7|95476|    3578|                   0|                None|                None|2000|        ActionDrama|   4.0|         0|                None|975890789|
|    1|   2017|     M| 25|        17|35808|     533|23937361377517...|Action|Sci-FiAct...|19981996199219...|1994|              Action|   4.0|       208|    ActionAdventure|974674625|
|    1|   1111|     F| 50|        16|44319|    1193|1569110531736...|Comedy|RomanceAc...|19971995199319...|1975|               Drama|   1.0|      3450|              Comedy|974918663|
|    1|   1215|     M| 35|        17|23602|    2105|26401748137420...|Action|Adventure|...|19781998198219...|1982|ActionAdventure...|   4.0|      3745|AdventureAnimati...|974843042|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+--------------------+----+--------------------+------+----------+--------------------+---------+
only showing top 10 rows

Debug -- match test dataset size: 18120
Debug -- match test types: [('label', 'string'), ('user_id', 'string'), ('gender', 'string'), ('age', 'string'), ('occupation', 'string'), ('zip', 'string'), ('movie_id', 'string'), ('recent_movie_ids', 'string'), ('recent_movie_genres', 'string'), ('recent_movie_years', 'string'), ('year', 'string'), ('genre', 'string'), ('rating', 'string'), ('last_movie', 'string'), ('last_genre', 'string')]
Debug -- match test dataset sample:
[Stage 51:====================================>                                                                    (69 + 32) / 200][Stage 51:====================================================>                                                   (101 + 32) / 200][Stage 51:=======================================================================>                                (138 + 32) / 200][Stage 51:==========================================================================================>             (174 + 26) / 200]                                                                                                                                   [Stage 58:=====================================>                                                                   (73 + 32) / 203][Stage 58:========================================================>                                               (111 + 32) / 203][Stage 58:=========================================================================>                              (144 + 32) / 203][Stage 58:============================================================================================>           (181 + 22) / 203]                                                                                                                                   [Stage 66:======================================>                                                                  (73 + 32) / 200][Stage 66:==========================================================>                                             (113 + 32) / 200][Stage 66:=============================================================================>                          (149 + 32) / 200][Stage 66:====================================================================================>                   (163 + 32) / 200][Stage 71:>                                                                                                         (0 + 32) / 200][Stage 71:=============>                                                                                           (25 + 32) / 200][Stage 71:================>                                                                                        (32 + 32) / 200][Stage 71:=================>                                                                                       (33 + 32) / 200][Stage 71:==============================>                                                                          (59 + 32) / 200][Stage 71:=================================>                                                                       (64 + 32) / 200][Stage 71:===================================>                                                                     (67 + 32) / 200][Stage 71:==================================================>                                                      (96 + 32) / 200][Stage 71:=====================================================>                                                  (102 + 32) / 200][Stage 71:==================================================================>                                     (128 + 32) / 200][Stage 71:===================================================================>                                    (129 + 32) / 200][Stage 71:============================================================================>                           (148 + 32) / 200][Stage 71:===================================================================================>                    (160 + 32) / 200][Stage 71:======================================================================================>                 (166 + 32) / 200][Stage 71:================================================================================================>       (186 + 14) / 200][Stage 71:====================================================================================================>    (191 + 9) / 200][Stage 71:=====================================================================================================>   (193 + 7) / 200]                                                                                                                                   [Stage 72:========================================>                                                                (78 + 32) / 200][Stage 72:===========================================================>                                            (114 + 32) / 200][Stage 72:=============================================================================>                          (149 + 32) / 200][Stage 72:===============================================================================================>        (184 + 16) / 200]                                                                                                                                   [Stage 86:>                                                                                                            (0 + 4) / 4]                                                                                                                                   /home/ec2-user/anaconda3/envs/metaspore/lib/python3.8/site-packages/pyspark/sql/dataframe.py:329: FutureWarning: Deprecated in 2.0, use createOrReplaceTempView instead.
  warnings.warn("Deprecated in 2.0, use createOrReplaceTempView instead.", FutureWarning)
+-----+-------+------+---+----------+----------+--------+--------------------+--------------------+--------------------+----+--------------------+------+----------+--------------------+
|label|user_id|gender|age|occupation|       zip|movie_id|    recent_movie_ids| recent_movie_genres|  recent_movie_years|year|               genre|rating|last_movie|          last_genre|
+-----+-------+------+---+----------+----------+--------+--------------------+--------------------+--------------------+----+--------------------+------+----------+--------------------+
|    1|    329|     M| 35|         7|     02115|    3826|37027903882391...|ComedyHorrorCom...|19941981200020...|2000|HorrorSci-FiThr...|   2.0|      3317|        ComedyDrama|
|    1|   3496|     M| 35|         5|     92867|    1580|34503255441164...|ComedyComedy|Dra...|19931992199319...|1997|ActionAdventure...|   4.0|       356|  ComedyRomanceWar|
|    1|    107|     M| 45|        18|     63129|    1674|14299339493230...|ActionComedy|Rom...|19961955195519...|1985|DramaRomanceThr...|   3.0|      2949|              Action|
|    1|   1139|     M| 25|         1|93420-2852|    3317|37933159375538...|Action|Sci-FiAni...|20001999200020...|2000|        ComedyDrama|   5.0|        40|               Drama|
|    1|    583|     F| 25|         0|     48067|    2122|18631224092642...|ComedyComedyAct...|19951995197919...|1984|     HorrorThriller|   3.0|      2643|ActionAdventure...|
|    1|    582|     M| 18|         4|     67042|      42|26723798379386...|Drama|Sci-Fi|Thri...|19992000200019...|1995|  ActionCrimeDrama|   5.0|      1246|               Drama|
|    1|   2652|     M| 35|        20|     84010|    1270|36853210342116...|Comedy|Drama|Roma...|19851982197819...|1985|       ComedySci-Fi|   5.0|      2918|              Comedy|
|    1|   1056|     M|  1|         0|     48133|    2706|17561981197925...|HorrorHorrorHor...|19981989198619...|1999|              Comedy|   1.0|       588|AnimationChildre...|
|    1|   4818|     F| 25|        17|     91007|    2355|12122151215022...|Mystery|Thriller...|19491989198019...|1998|AnimationChildre...|   3.0|      3000|ActionAdventure...|
|    1|   4385|     M| 25|         4|     93940|    3783|33263183174314...|Comedy|Sci-FiDra...|20001994199919...|1998|         CrimeDrama|   4.0|      3831|              Comedy|
+-----+-------+------+---+----------+----------+--------+--------------------+--------------------+--------------------+----+--------------------+------+----------+--------------------+
only showing top 10 rows

Debug -- write_dataset_to_s3 train cost time: 107.0762710571289
Debug -- write_dataset_to_s3 test cost time: 4.938705205917358
Debug -- spark stop
